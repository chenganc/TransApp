<head>
  <!--CDN Jquery-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <%= javascript_include_tag('jquery.ajax-cross-origin.min.js') %>
  <style>
     #map {
      height: 500px;
      width: 100%;
     }
  </style>
</head>

  <script src="//maps.google.com/maps/api/js?key=AIzaSyAlWA5Jo3dOsM34gtRw8lk45kOsxH3KoQc"></script>
  <script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
  <script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script>
<body class="background-black">
<div class="panel panel-primary">
<div class="panel-heading">
  <h3>Active Translink Bus Locations</h3>
  Use the drop down list below to display the current position of buses. Click on the bus marker to show additional information about that particular bus. Route list last updated: November 25, 2016.
</div>

<div style='width: auto;'>
  <div id="busMap" style='width: auto; height: 400px;'></div>
</div>

<div class="panel-body">
  <div class="input group">
  <form>
      <!--<p><label>Route Number: </label> <input type ="text" name"routeNumber" id="routeNumber" /></p>-->
      Route Number:
      <select id = "routeNumber" style="color:black">
        <option>  2 </option>
        <option>  3 </option>
        <option>  4 </option>
        <option>  5 </option>
        <option>  6 </option>
        <option>  7 </option>
        <option>  8 </option>
        <option>  9 </option>
        <option>  10  </option>
        <option>  14  </option>
        <option>  15  </option>
        <option>  16  </option>
        <option>  17  </option>
        <option>  19  </option>
        <option>  20  </option>
        <option>  22  </option>
        <option>  25  </option>
        <option>  26  </option>
        <option>  27  </option>
        <option>  28  </option>
        <option>  29  </option>
        <option>  32  </option>
        <option>  33  </option>
        <option>  41  </option>
        <option>  43  </option>
        <option>  44  </option>
        <option>  49  </option>
        <option>  50  </option>
        <option>  84  </option>
        <option>  96  </option>
        <option>  97  </option>
        <option>  99  </option>
        <option>  100 </option>
        <option>  101 </option>
        <option>  104 </option>
        <option>  106 </option>
        <option>  110 </option>
        <option>  112 </option>
        <option>  116 </option>
        <option>  123 </option>
        <option>  125 </option>
        <option>  128 </option>
        <option>  129 </option>
        <option>  130 </option>
        <option>  134 </option>
        <option>  135 </option>
        <option>  136 </option>
        <option>  143 </option>
        <option>  144 </option>
        <option>  145 </option>
        <option>  150 </option>
        <option>  151 </option>
        <option>  152 </option>
        <option>  153 </option>
        <option>  155 </option>
        <option>  156 </option>
        <option>  157 </option>
        <option>  159 </option>
        <option>  160 </option>
        <option>  169 </option>
        <option>  178 </option>
        <option>  188 </option>
        <option>  190 </option>
        <option>  209 </option>
        <option>  210 </option>
        <option>  211 </option>
        <option>  212 </option>
        <option>  214 </option>
        <option>  227 </option>
        <option>  228 </option>
        <option>  229 </option>
        <option>  230 </option>
        <option>  231 </option>
        <option>  232 </option>
        <option>  236 </option>
        <option>  239 </option>
        <option>  240 </option>
        <option>  241 </option>
        <option>  242 </option>
        <option>  246 </option>
        <option>  247 </option>
        <option>  250 </option>
        <option>  251 </option>
        <option>  252 </option>
        <option>  253 </option>
        <option>  254 </option>
        <option>  255 </option>
        <option>  256 </option>
        <option>  257 </option>
        <option>  258 </option>
        <option>  259 </option>
        <option>  301 </option>
        <option>  311 </option>
        <option>  312 </option>
        <option>  314 </option>
        <option>  316 </option>
        <option>  319 </option>
        <option>  320 </option>
        <option>  321 </option>
        <option>  323 </option>
        <option>  324 </option>
        <option>  325 </option>
        <option>  326 </option>
        <option>  329 </option>
        <option>  335 </option>
        <option>  337 </option>
        <option>  340 </option>
        <option>  341 </option>
        <option>  342 </option>
        <option>  345 </option>
        <option>  351 </option>
        <option>  352 </option>
        <option>  354 </option>
        <option>  364 </option>
        <option>  375 </option>
        <option>  388 </option>
        <option>  391 </option>
        <option>  393 </option>
        <option>  394 </option>
        <option>  395 </option>
        <option>  401 </option>
        <option>  402 </option>
        <option>  403 </option>
        <option>  404 </option>
        <option>  405 </option>
        <option>  407 </option>
        <option>  410 </option>
        <option>  430 </option>
        <option>  480 </option>
        <option>  501 </option>
        <option>  502 </option>
        <option>  503 </option>
        <option>  509 </option>
        <option>  531 </option>
        <option>  555 </option>
        <option>  590 </option>
        <option>  595 </option>
        <option>  601 </option>
        <option>  602 </option>
        <option>  603 </option>
        <option>  604 </option>
        <option>  606 </option>
        <option>  608 </option>
        <option>  609 </option>
        <option>  620 </option>
        <option>  640 </option>
        <option>  701 </option>
        <option>  791 </option>
        <option>  804 </option>
        <option>  807 </option>
        <option>  828 </option>
        <option>  840 </option>
        <option>  848 </option>
        <option>  855 </option>
        <option>  861 </option>
        <option>  863 </option>
        <option>  864 </option>
        <option>  865 </option>
        <option>  866 </option>
        <option>  867 </option>
        <option>  868 </option>
        <option>  880 </option>
        <option>  881 </option>
        <option>  890 </option>
        <option>  891 </option>
        <option>  892 </option>
        <option>  893 </option>
        <option>  894 </option>
        <option>  895 </option>
        <option>  980 </option>
        <option>  991 </option>
        <option>  992 </option>
        <option>  996 </option>
        <option>  997 </option>
        <option>  998 </option>
        <option>  999 </option>
        <option>  C1  </option>
        <option>  C10 </option>
        <option>  C11 </option>
        <option>  C12 </option>
        <option>  C15 </option>
        <option>  C18 </option>
        <option>  C19 </option>
        <option>  C2  </option>
        <option>  C20 </option>
        <option>  C21 </option>
        <option>  C23 </option>
        <option>  C24 </option>
        <option>  C25 </option>
        <option>  C26 </option>
        <option>  C27 </option>
        <option>  C28 </option>
        <option>  C29 </option>
        <option>  C3  </option>
        <option>  C30 </option>
        <option>  C36 </option>
        <option>  C37 </option>
        <option>  C38 </option>
        <option>  C4  </option>
        <option>  C40 </option>
        <option>  C41 </option>
        <option>  C43 </option>
        <option>  C44 </option>
        <option>  C45 </option>
        <option>  C46 </option>
        <option>  C47 </option>
        <option>  C48 </option>
        <option>  C49 </option>
        <option>  C5  </option>
        <option>  C50 </option>
        <option>  C51 </option>
        <option>  C52 </option>
        <option>  C53 </option>
        <option>  C6  </option>
        <option>  C60 </option>
        <option>  C61 </option>
        <option>  C62 </option>
        <option>  C63 </option>
        <option>  C64 </option>
        <option>  C7  </option>
        <option>  C70 </option>
        <option>  C71 </option>
        <option>  C73 </option>
        <option>  C75 </option>
        <option>  C76 </option>
        <option>  C8  </option>
        <option>  C84 </option>
        <option>  C86 </option>
        <option>  C87 </option>
        <option>  C88 </option>
        <option>  C89 </option>
        <option>  C9  </option>
        <option>  C92 </option>
        <option>  C93 </option>
        <option>  C94 </option>
        <option>  C96 </option>
        <option>  C98 </option>
        <option>  N10 </option>
        <option>  N15 </option>
        <option>  N17 </option>
        <option>  N19 </option>
        <option>  N20 </option>
        <option>  N22 </option>
        <option>  N24 </option>
        <option>  N35 </option>
        <option>  N8  </option>
        <option>  N9  </option>
        <option>  P25 </option>
      </select>
      <span class="input-group-btn">
        <button type="button" class="btn btn-secondary" name="submit" id="submit"  onclick="translinkBusCall()">View active buses in route</button>
      </span>
  </form>
  </div>
</div>

  <script type="text/javascript">

    var handler = Gmaps.build('Google');
    handler.buildMap({ provider: {zoom: 11, center: new google.maps.LatLng(49.246292, -123.116226)},internal: {id: 'busMap' }});

    function translinkBusCall(){
      var bus = $('#routeNumber').val();
      var allBusQuery = 'http://api.translink.ca/rttiapi/v1/buses?apikey=Oh2x83Ureq27heBPDVo1&routeNo='+bus;
      //alert(allBusQuery);

      $.ajax({
        crossOrigin: true,
        type: "GET",
        url:  allBusQuery,

        error: function(data){
          alert('No active buses for selected route.');
        },

        success: function(data){
          $(data).find("Bus").each(function(){
            var routeNumber = $(this).find('RouteNo').text();
            var vehicleNumber = $(this).find('VehicleNo').text();
            var busLat = $(this).find('Latitude').text();
            var busLon = $(this).find('Longitude').text();
            var direction = $(this).find('Direction').text();

            var busMarkers = handler.addMarkers([
              {lat: busLat,
               lng: busLon,
               picture: {
                url: "<%= asset_path('icon-red-01.png') %>",
                width:  30,
                height: 30
               },
               infowindow: 'Route Number: '+ routeNumber + '<br>' + 'Vehicle Number: ' + vehicleNumber + '<br>' + 'Direction: ' + direction
              }
            ]);
          })
        }
      });
    }

</script>
